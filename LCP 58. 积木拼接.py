# -*- coding: utf-8 -*-
# æ¬¢è¿å„ä½å‹‡è€…æ¥åˆ°åŠ›æ‰£åŸï¼Œæœ¬æ¬¡è¯•ç‚¼ä¸»é¢˜ä¸ºã€Œç§¯æœ¨æ‹¼æ¥ã€ã€‚
# å‹‡è€…é¢å‰æœ‰ `6` ç‰‡ç§¯æœ¨ï¼ˆåšåº¦å‡ä¸º 1ï¼‰ï¼Œæ¯ç‰‡ç§¯æœ¨çš„å½¢çŠ¶è®°å½•äºäºŒç»´å­—ç¬¦ä¸²æ•°ç»„ `shapes` ä¸­ï¼Œ`shapes[i]` è¡¨ç¤ºç¬¬ `i` ç‰‡ç§¯æœ¨ï¼Œå…¶ä¸­
# `1` è¡¨ç¤ºç§¯æœ¨å¯¹åº”ä½ç½®æ— ç©ºç¼ºï¼Œ`0` è¡¨ç¤ºç§¯æœ¨å¯¹åº”ä½ç½®æœ‰ç©ºç¼ºã€‚
# ä¾‹å¦‚ `["010","111","010"]` å¯¹åº”ç§¯æœ¨å½¢çŠ¶ä¸º
# ![image.png](https://pic.leetcode-cn.com/1616125620-nXMCxX-image.png)
#
# æ‹¼æ¥ç§¯æœ¨çš„è§„åˆ™å¦‚ä¸‹ï¼š
# - ç§¯æœ¨ç‰‡å¯ä»¥æ—‹è½¬ã€ç¿»é¢
# - ç§¯æœ¨ç‰‡è¾¹ç¼˜å¿…é¡»å®Œå…¨å»åˆæ‰èƒ½æ‹¼æ¥åœ¨ä¸€èµ·
# - **æ¯ç‰‡ç§¯æœ¨ç‰‡ `shapes[i]` çš„ä¸­å¿ƒç‚¹åœ¨æ‹¼æ¥æ—¶å¿…é¡»å¤„äºæ­£æ–¹ä½“å¯¹åº”é¢çš„ä¸­å¿ƒç‚¹**
#
# ä¾‹å¦‚ `3*3`ã€`4*4` çš„ç§¯æœ¨ç‰‡çš„ä¸­å¿ƒç‚¹å¦‚å›¾æ‰€ç¤ºï¼ˆçº¢è‰²ç‚¹ï¼‰ï¼š
# ![middle_img_v2_c2d91eb5-9beb-4c06-9726-f7dae149d86g.png](https://pic.
# leetcode-cn.com/1650509082-wObiEp-middle_img_v2_c2d91eb5-9beb-4c06-9726-f7dae149d86g.
# png){:height="150px"}
#
# è¯·è¿”å›è¿™ 6 ç‰‡ç§¯æœ¨èƒ½å¦æ‹¼æ¥æˆä¸€ä¸ª**ä¸¥ä¸åˆç¼çš„æ­£æ–¹ä½“**ä¸”æ¯ç‰‡ç§¯æœ¨æ­£å¥½å¯¹åº”æ­£æ–¹ä½“çš„ä¸€ä¸ªé¢ã€‚
#
# **æ³¨æ„ï¼š**
# - è¾“å…¥ç¡®ä¿æ¯ç‰‡ç§¯æœ¨å‡æ— ç©ºå¿ƒæƒ…å†µï¼ˆå³è¾“å…¥æ•°æ®ä¿è¯å¯¹äºå¤§å° `N*N` çš„ `shapes[i]`ï¼Œå†…éƒ¨çš„ `(N-2)*(N-2)` çš„åŒºåŸŸå¿…ç„¶å‡ä¸º 1ï¼‰
# - è¾“å…¥ç¡®ä¿æ¯ç‰‡ç§¯æœ¨çš„æ‰€æœ‰ `1` ä½ç½®å‡è¿é€š
#
# **ç¤ºä¾‹ 1ï¼š**
#
# > è¾“å…¥ï¼š`shapes = [["000","110","000"],["110","011","000"],["110","011","110"],[
# "000","010","111"],["011","111","011"],["011","010","000"]]`
# >
# > è¾“å‡ºï¼š`true`
# >
# > è§£é‡Šï¼š
# > ![cube.gif](https://pic.leetcode-cn.com/1616125823-hkXAeN-cube.gif)
#
# **ç¤ºä¾‹ 2ï¼š**
#
# > è¾“å…¥ï¼š`shapes = [["101","111","000"],["000","010","111"],["010","011","000"],[
# "010","111","010"],["101","111","010"],["000","010","011"]]`
# >
# > è¾“å‡ºï¼š`false`
# >
# > è§£é‡Šï¼š
# > ç”±äºæ¯ç‰‡ç§¯æœ¨ç‰‡çš„ä¸­å¿ƒç‚¹åœ¨æ‹¼æ¥æ—¶å¿…é¡»å¤„äºæ­£æ–¹ä½“å¯¹åº”é¢çš„ä¸­å¿ƒç‚¹ï¼Œç§¯æœ¨ç‰‡ `["010","011","000"]` ä¸èƒ½ä½œä¸º `["100","110",
# "000"]` ä½¿ç”¨ï¼Œå› æ­¤æ— æ³•æ„æˆæ­£æ–¹ä½“
#
# **æç¤ºï¼š**
# - `shapes.length == 6`
# - `shapes[i].length == shapes[j].length`
# - `shapes[i].length == shapes[i][j].length`
# - `3 <= shapes[i].length <= 10`
#
#  Related Topics æ•°ç»„ å›æº¯ çŸ©é˜µ
#  ğŸ‘ 5 ğŸ‘ 0
import itertools

from typing import List


# leetcode submit region begin(Prohibit modification and deletion)
class Solution:
    def composeCube(self, shapes: List[List[str]]) -> bool:
        n = len(shapes[0])

        def cal(shape):  # è®¡ç®—æ¯ä¸ªå½¢çŠ¶çš„ç©ºé—´å ç”¨æƒ…å†µ,6ä¸ªé¢ï¼Œ4ä¸ªæ–¹å‘ï¼Œä¸¤æ¬¡ç¿»è½¬
            res = [0] * 48
            for x, y in itertools.product(range(n), range(n)):
                if shape[x][y] != "1":
                    continue
                for turn, (xt, yt) in enumerate([(x, y), (x, n - 1 - y)]):  # ä¸Šä¸‹ç¿»è½¬
                    for rotate, (xr, yr) in enumerate([(xt, yt), (yt, n - 1 - xt), (n - 1 - xt, n - 1 - yt), (n - 1 - yt, xt)]):  # ä¸­å¿ƒæ—‹è½¬
                        for side, (xs, ys, zs) in enumerate(
                                [(xr, yr, 0), (xr, yr, n - 1), (xr, 0, yr), (xr, n - 1, yr), (0, xr, yr), (n - 1, xr, yr)]):
                            res[turn * 24 + rotate * 6 + side] |= 1 << (xs * n * n + ys * n + zs)
            return res

        sum_ = 2 * n * n + 2 * n * (n - 2) + 2 * (n - 2) * (n - 2)
        if sum(''.join(shape).count("1") for shape in shapes) != sum_:
            return False
        first = cal(shapes[0])
        dp = {first[0], first[24]}  # ç¬¬ä¸€ä¸ªç§¯æœ¨å¯ä»¥ä»»æ„æ‘†æ”¾ï¼Œè€ƒè™‘æ­£åä¸¤é¢
        for shape in shapes[1:]:
            dp = {pre | aft for pre in dp for aft in cal(shape) if pre & aft == 0}  # ä¸¤ä¸ªç§¯æœ¨çš„ç©ºé—´å ç”¨ä¸èƒ½é‡å 
        return len(dp) > 0


# leetcode submit region end(Prohibit modification and deletion)
print(Solution().composeCube(
    [["000", "110", "000"], ["110", "011", "000"], ["110", "011", "110"], ["000", "010", "111"], ["011", "111", "011"], ["011", "010", "000"]]
))
