# -*- coding: utf-8 -*-
import collections, heapq, itertools
from typing import List


# ä½ æƒ³è¦ç”¨å°å†™å­—æ¯ç»„æˆä¸€ä¸ªç›®æ ‡å­—ç¬¦ä¸² targetã€‚
#
#  å¼€å§‹çš„æ—¶å€™ï¼Œåºåˆ—ç”± target.length ä¸ª '?' è®°å·ç»„æˆã€‚è€Œä½ æœ‰ä¸€ä¸ªå°å†™å­—æ¯å°ç«  stampã€‚
#
#  åœ¨æ¯ä¸ªå›åˆï¼Œä½ å¯ä»¥å°†å°ç« æ”¾åœ¨åºåˆ—ä¸Šï¼Œå¹¶å°†åºåˆ—ä¸­çš„æ¯ä¸ªå­—æ¯æ›¿æ¢ä¸ºå°ç« ä¸Šçš„ç›¸åº”å­—æ¯ã€‚ä½ æœ€å¤šå¯ä»¥è¿›è¡Œ 10 * target.length ä¸ªå›åˆã€‚
#
#  ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœåˆå§‹åºåˆ—ä¸º "?????"ï¼Œè€Œä½ çš„å°ç«  stamp æ˜¯ "abc"ï¼Œé‚£ä¹ˆåœ¨ç¬¬ä¸€å›åˆï¼Œä½ å¯ä»¥å¾—åˆ° "abc??"ã€"?abc?"ã€"??abc
# "ã€‚ï¼ˆè¯·æ³¨æ„ï¼Œå°ç« å¿…é¡»å®Œå…¨åŒ…å«åœ¨åºåˆ—çš„è¾¹ç•Œå†…æ‰èƒ½ç›–ä¸‹å»ã€‚ï¼‰
#
#  å¦‚æœå¯ä»¥å°å‡ºåºåˆ—ï¼Œé‚£ä¹ˆè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œè¯¥æ•°ç»„ç”±æ¯ä¸ªå›åˆä¸­è¢«å°ä¸‹çš„æœ€å·¦è¾¹å­—æ¯çš„ç´¢å¼•ç»„æˆã€‚å¦‚æœä¸èƒ½å°å‡ºåºåˆ—ï¼Œå°±è¿”å›ä¸€ä¸ªç©ºæ•°ç»„ã€‚
#
#  ä¾‹å¦‚ï¼Œå¦‚æœåºåˆ—æ˜¯ "ababc"ï¼Œå°ç« æ˜¯ "abc"ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è¿”å›ä¸æ“ä½œ "?????" -> "abc??" -> "ababc" ç›¸å¯¹åº”çš„ç­”æ¡ˆ
# [0, 2]ï¼›
#
#  å¦å¤–ï¼Œå¦‚æœå¯ä»¥å°å‡ºåºåˆ—ï¼Œé‚£ä¹ˆéœ€è¦ä¿è¯å¯ä»¥åœ¨ 10 * target.length ä¸ªå›åˆå†…å®Œæˆã€‚ä»»ä½•è¶…è¿‡æ­¤æ•°å­—çš„ç­”æ¡ˆå°†ä¸è¢«æ¥å—ã€‚
#
#
#
#  ç¤ºä¾‹ 1ï¼š
#
#  è¾“å…¥ï¼šstamp = "abc", target = "ababc"
# è¾“å‡ºï¼š[0,2]
# ï¼ˆ[1,0,2] ä»¥åŠå…¶ä»–ä¸€äº›å¯èƒ½çš„ç»“æœä¹Ÿå°†ä½œä¸ºç­”æ¡ˆè¢«æ¥å—ï¼‰
#
#
#  ç¤ºä¾‹ 2ï¼š
#
#  è¾“å…¥ï¼šstamp = "abca", target = "aabcaca"
# è¾“å‡ºï¼š[3,0,1]
#
#
#
#
#  æç¤ºï¼š
#
#
#  1 <= stamp.length <= target.length <= 1000
#  stamp å’Œ target åªåŒ…å«å°å†™å­—æ¯ã€‚
#
#  Related Topics è´ªå¿ƒç®—æ³• å­—ç¬¦ä¸²
#  ğŸ‘ 33 ğŸ‘ 0


class Solution:
    def movesToStamp(self, stamp: str, target: str) -> List[int]:
        n, N = len(stamp), len(target)
        base = [False] * N  # ç»ˆç‚¹æƒ…å†µ
        q = collections.deque()
        st = []
        ans = []
        for i in range(N - n + 1):
            made, todo = set(), set()  # ä»¥æ¯ä¸ªå­—ç¬¦ä¸ºèµ·ç‚¹ï¼Œç›–ä¸Šæˆ³åæƒ…å†µåˆ†æ
            for j in range(n):
                if target[i + j] != stamp[j]:
                    todo.add(i + j)  # ä¸åŒ¹é…çš„
                else:
                    made.add(i + j)  # åŒ¹é…çš„
            st.append((made, todo))
            if not todo:  # å®Œå…¨åŒ¹é…
                ans.append(i)  # æ·»åŠ åˆ°ç­”æ¡ˆ
                for k in range(i, i + n):  # å°†è¿™ä¸€ä¸²æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œä¸è¿™ä¸€ä¸²å­—ç¬¦ç›¸äº¤çš„éƒ¨åˆ†è¿›è¡Œä¸‹ä¸€æ­¥è€ƒå¯Ÿ
                    if not base[k]:
                        q.append(k)
                        base[k] = True
        while q:
            j = q.popleft()
            for i in range(max(0, j - n + 1), min(j, N - n) + 1): #æ¯ä¸ªå­—æ¯å½±å“çš„çª—å£
                if j in st[i][1]:
                    st[i][1].discard(j) #è¢«å½±å“çš„çª—å£è¦å‰”æ‰ï¼Œå› ä¸ºåŸæ¥è¿™ä¸ªä¸åŒ¹é…ï¼Œå› ä¸ºåä¸€ä¸ªæˆ³æ¶ˆé™¤æ‰äº†ï¼Œä¸åŒ¹é…çš„è¿™ä¸ªå­—æ¯å¯ä»¥ä¸ºä»»æ„å­—æ¯ï¼Œä¹Ÿå°±åŒ¹é…äº†
                    if not st[i][1]:
                        ans.append(i)
                        for k in st[i][0]:
                            if not base[k]:
                                base[k]=True
                                q.append(k)
        return ans[::-1] if all(base) else []
Solution().movesToStamp(stamp = "abca", target = "aabcaca")