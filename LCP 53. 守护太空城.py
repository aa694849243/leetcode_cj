# -*- coding: utf-8 -*-
# å„ä½å‹‡è€…è¯·æ³¨æ„ï¼ŒåŠ›æ‰£å¤ªç©ºåŸå‘å¸ƒé™¨çŸ³é›¨çº¢è‰²é¢„è­¦ã€‚
#
# å¤ªç©ºåŸä¸­çš„ä¸€äº›èˆ±å®¤å°†è¦å—åˆ°é™¨çŸ³é›¨çš„å†²å‡»ï¼Œè¿™äº›èˆ±å®¤æŒ‰ç…§ç¼–å· `0 ~ N` çš„é¡ºåºä¾æ¬¡æ’åˆ—ã€‚ä¸ºäº†é˜»æŒ¡é™¨çŸ³æŸæ¯èˆ±å®¤ï¼Œå¤ªç©ºåŸå¯ä»¥ä½¿ç”¨èƒ½é‡å±•å¼€é˜²æŠ¤å±éšœï¼Œå…·ä½“æ¶ˆè€—å¦‚ä¸‹
# ï¼š
#
# - é€‰æ‹©ä¸€ä¸ªèˆ±å®¤å¼€å¯å±éšœï¼Œèƒ½é‡æ¶ˆè€—ä¸º `2`
# - é€‰æ‹©ç›¸é‚»ä¸¤ä¸ªèˆ±å®¤å¼€å¯è”åˆå±éšœï¼Œèƒ½é‡æ¶ˆè€—ä¸º `3`
# - å¯¹äºå·²å¼€å¯çš„**ä¸€ä¸ª**å±éšœï¼Œ**å¤šç»´æŒä¸€æ—¶åˆ»**ï¼Œèƒ½é‡æ¶ˆè€—ä¸º `1`
#
# å·²çŸ¥é™¨çŸ³é›¨çš„å½±å“èŒƒå›´å’Œåˆ°è¾¾æ—¶åˆ»ï¼Œ`time[i]` å’Œ `position[i]` åˆ†åˆ«è¡¨ç¤ºè¯¥é™¨çŸ³çš„åˆ°è¾¾æ—¶åˆ»å’Œå†²å‡»ä½ç½®ã€‚è¯·è¿”å›å¤ªç©ºèˆ±èƒ½å¤Ÿå®ˆæŠ¤æ‰€æœ‰èˆ±å®¤æ‰€éœ€è¦çš„
# æœ€å°‘èƒ½é‡ã€‚
#
# **æ³¨æ„ï¼š**
# - åŒä¸€æ—¶é—´ï¼Œä¸€ä¸ªèˆ±å®¤ä¸èƒ½è¢«å¤šä¸ªå±éšœè¦†ç›–
# - é™¨çŸ³é›¨ä»…åœ¨åˆ°è¾¾æ—¶åˆ»å¯¹å†²å‡»ä½ç½®å¤„çš„èˆ±å®¤æœ‰å½±å“
#
# **ç¤ºä¾‹ 1ï¼š**
#
# > è¾“å…¥ï¼š`time = [1,2,1], position = [6,3,3]`
# >
# > è¾“å‡ºï¼š`5`
# >
# > è§£é‡Šï¼š
# > æ—¶åˆ» 1ï¼Œåˆ†åˆ«å¼€å¯ç¼–å· 3ã€6 èˆ±å®¤çš„å±éšœï¼Œèƒ½é‡æ¶ˆè€— 2*2 = 4
# > æ—¶åˆ» 2ï¼Œç»´æŒç¼–å· 3 èˆ±å®¤çš„å±éšœï¼Œèƒ½é‡æ¶ˆè€— 1
# > å› æ­¤ï¼Œæœ€å°‘éœ€è¦èƒ½é‡ 5
#
# **ç¤ºä¾‹ 2ï¼š**
#
# > è¾“å…¥ï¼š`time = [1,1,1,2,2,3,5], position = [1,2,3,1,2,1,3]`
# >
# > è¾“å‡ºï¼š`9`
# >
# > è§£é‡Šï¼š
# > æ—¶åˆ» 1ï¼Œå¼€å¯ç¼–å· 1ã€2 èˆ±å®¤çš„è”åˆå±éšœï¼Œèƒ½é‡æ¶ˆè€— 3
# > æ—¶åˆ» 1ï¼Œå¼€å¯ç¼–å· 3 èˆ±å®¤çš„å±éšœï¼Œèƒ½é‡æ¶ˆè€— 2
# > æ—¶åˆ» 2ï¼Œç»´æŒç¼–å· 1ã€2 èˆ±å®¤çš„è”åˆå±éšœï¼Œèƒ½é‡æ¶ˆè€— 1
# > æ—¶åˆ» 3ï¼Œç»´æŒç¼–å· 1ã€2 èˆ±å®¤çš„è”åˆå±éšœï¼Œèƒ½é‡æ¶ˆè€— 1
# > æ—¶åˆ» 5ï¼Œé‡æ–°å¼€å¯ç¼–å· 3 èˆ±å®¤çš„è”åˆå±éšœï¼Œèƒ½é‡æ¶ˆè€— 2
# > å› æ­¤ï¼Œæœ€å°‘éœ€è¦èƒ½é‡ 9
#
# **æç¤ºï¼š**
# + `1 <= time.length == position.length <= 500`
# + `1 <= time[i] <= 5`
# + `0 <= position[i] <= 100`
#
#  Related Topics ä½è¿ç®— æ•°ç»„ åŠ¨æ€è§„åˆ’ çŠ¶æ€å‹ç¼©
#  ğŸ‘ 9 ğŸ‘ 0


# leetcode submit region begin(Prohibit modification and deletion)
# https://leetcode.cn/problems/EJvmW4/solution/by-endlesscheng-pk2q/
class Solution:
    def defendSpaceCity(self, time: List[int], position: List[int]) -> int:
        n, m = max(position), 1 << max(time)
        p_state = [0] * (n + 1)
        for t, p in zip(time, position):
            p_state[p] |= 1 << (t - 1)

        union = [0] * m  # union[i] è¡¨ç¤ºiçŠ¶æ€ï¼Œå¼€å¯çš„è”åˆå±éšœèŠ±è´¹
        single = [0] * m
        for i in range(1, m):  # é¢„å¤„ç†å¼€å¯è”åˆå±éšœå’Œå•ä¸ªå±éšœçš„çŠ¶æ€
            b1 = i & -i
            j = i ^ b1
            b2 = j & -j
            union[i] = union[j] + (1 if b1 == b2 >> 1 else 3)
            single[i] = single[j] + (1 if b1 == b2 >> 1 else 2)
        f = [[float('inf')] * (m) for _ in range(n + 1)]
        for i in range(m):
            f[0][i] = union[i] + single[((m - 1) ^ i) & p_state[0]]
        for i in range(1, n + 1):
            for j in range(m):
                pre = mask = (m - 1) ^ j  # preä»£è¡¨ä¸Šä¸€ä½ç‚¹å¼€å¯è”åˆå±éšœçš„çŠ¶æ€(æ—¶é—´)
                while 1: # preä¸jä¸é‡åˆï¼Œjå›ºå®šï¼Œæ¯æ¬¡å‘ä¸‹æ›´æ–°preï¼Œå¢åŠ æ›´å¤šçš„å•ä¸ªå±éšœ
                    f[i][j] = min(f[i][j], f[i - 1][pre] + union[j] + single[(mask ^ pre) & p_state[i]])
                    if not pre: break
                    pre = (pre - 1) & mask
        return f[n][0] # æœ€åä¸€ä¸ªç‚¹ä¸ç”¨å¼€å¯è”åˆå±éšœ
# leetcode submit region end(Prohibit modification and deletion)
