# -*- coding: utf-8 -*-
import heapq
from typing import List
import collections
import functools
import itertools
import sortedcontainers
import bisect


# ç»™ä½ ä¸€æ£µæ ‘ï¼ˆå³ï¼Œä¸€ä¸ªè¿é€šçš„æ— ç¯æ— å‘å›¾ï¼‰ï¼Œè¿™æ£µæ ‘ç”±ç¼–å·ä» 0 åˆ° n - 1 çš„ n ä¸ªèŠ‚ç‚¹ç»„æˆï¼Œä¸”æ°å¥½æœ‰ n - 1 æ¡ edges ã€‚æ ‘çš„æ ¹èŠ‚ç‚¹ä¸ºèŠ‚ç‚¹ 0
#  ï¼Œæ ‘ä¸Šçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªæ ‡ç­¾ï¼Œä¹Ÿå°±æ˜¯å­—ç¬¦ä¸² labels ä¸­çš„ä¸€ä¸ªå°å†™å­—ç¬¦ï¼ˆç¼–å·ä¸º i çš„ èŠ‚ç‚¹çš„æ ‡ç­¾å°±æ˜¯ labels[i] ï¼‰
#
#  è¾¹æ•°ç»„ edges ä»¥ edges[i] = [ai, bi] çš„å½¢å¼ç»™å‡ºï¼Œè¯¥æ ¼å¼è¡¨ç¤ºèŠ‚ç‚¹ ai å’Œ bi ä¹‹é—´å­˜åœ¨ä¸€æ¡è¾¹ã€‚
#
#  è¿”å›ä¸€ä¸ªå¤§å°ä¸º n çš„æ•°ç»„ï¼Œå…¶ä¸­ ans[i] è¡¨ç¤ºç¬¬ i ä¸ªèŠ‚ç‚¹çš„å­æ ‘ä¸­ä¸èŠ‚ç‚¹ i æ ‡ç­¾ç›¸åŒçš„èŠ‚ç‚¹æ•°ã€‚
#
#  æ ‘ T ä¸­çš„å­æ ‘æ˜¯ç”± T ä¸­çš„æŸä¸ªèŠ‚ç‚¹åŠå…¶æ‰€æœ‰åä»£èŠ‚ç‚¹ç»„æˆçš„æ ‘ã€‚
#
#
#
#  ç¤ºä¾‹ 1ï¼š
#
#
#
#  è¾“å…¥ï¼šn = 7, edges = [[0,1],[0,2],[1,4],[1,5],[2,3],[2,6]], labels = "abaedcd"
# è¾“å‡ºï¼š[2,1,1,1,1,1,1]
# è§£é‡Šï¼šèŠ‚ç‚¹ 0 çš„æ ‡ç­¾ä¸º 'a' ï¼Œä»¥ 'a' ä¸ºæ ¹èŠ‚ç‚¹çš„å­æ ‘ä¸­ï¼ŒèŠ‚ç‚¹ 2 çš„æ ‡ç­¾ä¹Ÿæ˜¯ 'a' ï¼Œå› æ­¤ç­”æ¡ˆä¸º 2 ã€‚æ³¨æ„æ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯è¿™æ£µå­æ ‘çš„ä¸€éƒ¨åˆ†ã€‚
#
# èŠ‚ç‚¹ 1 çš„æ ‡ç­¾ä¸º 'b' ï¼ŒèŠ‚ç‚¹ 1 çš„å­æ ‘åŒ…å«èŠ‚ç‚¹ 1ã€4 å’Œ 5ï¼Œä½†æ˜¯èŠ‚ç‚¹ 4ã€5 çš„æ ‡ç­¾ä¸èŠ‚ç‚¹ 1 ä¸åŒï¼Œæ•…è€Œç­”æ¡ˆä¸º 1ï¼ˆå³ï¼Œè¯¥èŠ‚ç‚¹æœ¬èº«ï¼‰ã€‚
#
#
#  ç¤ºä¾‹ 2ï¼š
#
#
#
#  è¾“å…¥ï¼šn = 4, edges = [[0,1],[1,2],[0,3]], labels = "bbbb"
# è¾“å‡ºï¼š[4,2,1,1]
# è§£é‡Šï¼šèŠ‚ç‚¹ 2 çš„å­æ ‘ä¸­åªæœ‰èŠ‚ç‚¹ 2 ï¼Œæ‰€ä»¥ç­”æ¡ˆä¸º 1 ã€‚
# èŠ‚ç‚¹ 3 çš„å­æ ‘ä¸­åªæœ‰èŠ‚ç‚¹ 3 ï¼Œæ‰€ä»¥ç­”æ¡ˆä¸º 1 ã€‚
# èŠ‚ç‚¹ 1 çš„å­æ ‘ä¸­åŒ…å«èŠ‚ç‚¹ 1 å’Œ 2 ï¼Œæ ‡ç­¾éƒ½æ˜¯ 'b' ï¼Œå› æ­¤ç­”æ¡ˆä¸º 2 ã€‚
# èŠ‚ç‚¹ 0 çš„å­æ ‘ä¸­åŒ…å«èŠ‚ç‚¹ 0ã€1ã€2 å’Œ 3ï¼Œæ ‡ç­¾éƒ½æ˜¯ 'b'ï¼Œå› æ­¤ç­”æ¡ˆä¸º 4 ã€‚
#
#
#  ç¤ºä¾‹ 3ï¼š
#
#
#
#  è¾“å…¥ï¼šn = 5, edges = [[0,1],[0,2],[1,3],[0,4]], labels = "aabab"
# è¾“å‡ºï¼š[3,2,1,1,1]
#
#
#  ç¤ºä¾‹ 4ï¼š
#
#  è¾“å…¥ï¼šn = 6, edges = [[0,1],[0,2],[1,3],[3,4],[4,5]], labels = "cbabaa"
# è¾“å‡ºï¼š[1,2,1,1,2,1]
#
#
#  ç¤ºä¾‹ 5ï¼š
#
#  è¾“å…¥ï¼šn = 7, edges = [[0,1],[1,2],[2,3],[3,4],[4,5],[5,6]], labels = "aaabaaa"
# è¾“å‡ºï¼š[6,5,4,1,3,2,1]
#
#
#
#
#  æç¤ºï¼š
#
#
#  1 <= n <= 10^5
#  edges.length == n - 1
#  edges[i].length == 2
#  0 <= ai, bi < n
#  ai != bi
#  labels.length == n
#  labels ä»…ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆ
#
#  Related Topics æ ‘ æ·±åº¦ä¼˜å…ˆæœç´¢ å¹¿åº¦ä¼˜å…ˆæœç´¢ ğŸ‘ 53 ğŸ‘ 0


class Solution:
    def countSubTrees(self, n: int, edges: List[List[int]], labels: str) -> List[int]:
        res = [0] * n
        g = collections.defaultdict(set)
        for vi, vj in edges:
            g[vi].add(vj)
            g[vj].add(vi)
        m = collections.defaultdict(int)

        def rec(parent, node):
            label = labels[node]
            pre = m[label]
            for nxt in g[node]:
                if nxt == parent:
                    continue
                m[node] += 1
                rec(node, nxt)
            m[label] += 1
            res[node] = m[label]-pre

        rec(-1, 0)
        return res


Solution().countSubTrees(6, [[0, 1], [0, 2], [1, 3], [3, 4], [4, 5]], "cbabaa")
