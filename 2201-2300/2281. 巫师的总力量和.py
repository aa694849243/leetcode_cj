# -*- coding: utf-8 -*-
# ä½œä¸ºå›½ç‹çš„ç»Ÿæ²»è€…ï¼Œä½ æœ‰ä¸€æ”¯å·«å¸ˆå†›é˜Ÿå¬ä½ æŒ‡æŒ¥ã€‚
#
#  ç»™ä½ ä¸€ä¸ªä¸‹æ ‡ä» 0 å¼€å§‹çš„æ•´æ•°æ•°ç»„ strength ï¼Œå…¶ä¸­ strength[i] è¡¨ç¤ºç¬¬ i ä½å·«å¸ˆçš„åŠ›é‡å€¼ã€‚å¯¹äºè¿ç»­çš„ä¸€ç»„å·«å¸ˆï¼ˆä¹Ÿå°±æ˜¯è¿™äº›å·«å¸ˆçš„åŠ›é‡
# å€¼æ˜¯ strength çš„ å­æ•°ç»„ï¼‰ï¼Œæ€»åŠ›é‡ å®šä¹‰ä¸ºä»¥ä¸‹ä¸¤ä¸ªå€¼çš„ ä¹˜ç§¯ ï¼š
#
#
#  å·«å¸ˆä¸­ æœ€å¼± çš„èƒ½åŠ›å€¼ã€‚
#  ç»„ä¸­æ‰€æœ‰å·«å¸ˆçš„ä¸ªäººåŠ›é‡å€¼ ä¹‹å’Œ ã€‚
#
#
#  è¯·ä½ è¿”å› æ‰€æœ‰ å·«å¸ˆç»„çš„ æ€» åŠ›é‡ä¹‹å’Œã€‚ç”±äºç­”æ¡ˆå¯èƒ½å¾ˆå¤§ï¼Œè¯·å°†ç­”æ¡ˆå¯¹ 10â¹ + 7 å–ä½™ åè¿”å›ã€‚
#
#  å­æ•°ç»„ æ˜¯ä¸€ä¸ªæ•°ç»„é‡Œ éç©º è¿ç»­å­åºåˆ—ã€‚
#
#
#
#  ç¤ºä¾‹ 1ï¼š
#
#  è¾“å…¥ï¼šstrength = [1,3,1,2]
# è¾“å‡ºï¼š44
# è§£é‡Šï¼šä»¥ä¸‹æ˜¯æ‰€æœ‰è¿ç»­å·«å¸ˆç»„ï¼š
# - [1,3,1,2] ä¸­ [1] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([1]) * sum([1]) = 1 * 1 = 1
# - [1,3,1,2] ä¸­ [3] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([3]) * sum([3]) = 3 * 3 = 9
# - [1,3,1,2] ä¸­ [1] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([1]) * sum([1]) = 1 * 1 = 1
# - [1,3,1,2] ä¸­ [2] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([2]) * sum([2]) = 2 * 2 = 4
# - [1,3,1,2] ä¸­ [1,3] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([1,3]) * sum([1,3]) = 1 * 4 = 4
# - [1,3,1,2] ä¸­ [3,1] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([3,1]) * sum([3,1]) = 1 * 4 = 4
# - [1,3,1,2] ä¸­ [1,2] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([1,2]) * sum([1,2]) = 1 * 3 = 3
# - [1,3,1,2] ä¸­ [1,3,1] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([1,3,1]) * sum([1,3,1]) = 1 * 5 = 5
# - [1,3,1,2] ä¸­ [3,1,2] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([3,1,2]) * sum([3,1,2]) = 1 * 6 = 6
# - [1,3,1,2] ä¸­ [1,3,1,2] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([1,3,1,2]) * sum([1,3,1,2]) = 1 * 7 = 7
# æ‰€æœ‰åŠ›é‡å€¼ä¹‹å’Œä¸º 1 + 9 + 1 + 4 + 4 + 4 + 3 + 5 + 6 + 7 = 44 ã€‚
#
#
#  ç¤ºä¾‹ 2ï¼š
#
#  è¾“å…¥ï¼šstrength = [5,4,6]
# è¾“å‡ºï¼š213
# è§£é‡Šï¼šä»¥ä¸‹æ˜¯æ‰€æœ‰è¿ç»­å·«å¸ˆç»„ï¼š
# - [5,4,6] ä¸­ [5] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([5]) * sum([5]) = 5 * 5 = 25
# - [5,4,6] ä¸­ [4] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([4]) * sum([4]) = 4 * 4 = 16
# - [5,4,6] ä¸­ [6] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([6]) * sum([6]) = 6 * 6 = 36
# - [5,4,6] ä¸­ [5,4] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([5,4]) * sum([5,4]) = 4 * 9 = 36
# - [5,4,6] ä¸­ [4,6] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([4,6]) * sum([4,6]) = 4 * 10 = 40
# - [5,4,6] ä¸­ [5,4,6] ï¼Œæ€»åŠ›é‡å€¼ä¸º min([5,4,6]) * sum([5,4,6]) = 4 * 15 = 60
# æ‰€æœ‰åŠ›é‡å€¼ä¹‹å’Œä¸º 25 + 16 + 36 + 36 + 40 + 60 = 213 ã€‚
#
#
#
#
#  æç¤ºï¼š
#
#
#  1 <= strength.length <= 10âµ
#  1 <= strength[i] <= 10â¹
#
#
#  Related Topics æ ˆ æ•°ç»„ å‰ç¼€å’Œ å•è°ƒæ ˆ
#  ğŸ‘ 81 ğŸ‘ 0
import itertools
from typing import List


# å‰ç¼€å’Œçš„å‰ç¼€å’Œ
# æ³¢è°·ä¸¤ç«¯/æ³¢å³°ä¸¤ç«¯
# leetcode submit region begin(Prohibit modification and deletion)
class Solution:
    def totalStrength(self, strength: List[int]) -> int:
        n = len(strength)
        left, right, stack = [-1] * n, [n] * n, []
        for i, val in enumerate(strength):
            while stack and strength[stack[-1]] >= val:
                right[stack.pop()] = i
            if stack:
                left[i] = stack[-1]
            stack.append(i)
        ss = list(itertools.accumulate(itertools.accumulate(strength, initial=0), initial=0))
        mod = 10 ** 9 + 7
        res = 0
        for i, val in enumerate(strength):
            L, R = left[i] + 1, right[i] - 1  # é—­åŒºé—´
            tot = (i - L + 1) * (ss[R + 2] - ss[i + 1]) - (R - i + 1) * (ss[i + 1] - ss[L])
            res += tot * val
            res %= mod
        return res

# leetcode submit region end(Prohibit modification and deletion)
