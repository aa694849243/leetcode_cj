#!/usr/bin/env python
# -*- coding: utf-8 -*-
import heapq
from typing import List


# ç”±ç©ºåœ°å’Œå¢™ç»„æˆçš„è¿·å®«ä¸­æœ‰ä¸€ä¸ªçƒã€‚çƒå¯ä»¥å‘ä¸Šï¼ˆuï¼‰ä¸‹ï¼ˆdï¼‰å·¦ï¼ˆlï¼‰å³ï¼ˆrï¼‰å››ä¸ªæ–¹å‘æ»šåŠ¨ï¼Œä½†åœ¨é‡åˆ°å¢™å£å‰ä¸ä¼šåœæ­¢æ»šåŠ¨ã€‚å½“çƒåœä¸‹æ—¶ï¼Œå¯ä»¥é€‰æ‹©ä¸‹ä¸€ä¸ªæ–¹å‘ã€‚è¿·å®«ä¸­è¿˜æœ‰
# ä¸€ä¸ªæ´ï¼Œå½“çƒè¿åŠ¨ç»è¿‡æ´æ—¶ï¼Œå°±ä¼šæ‰è¿›æ´é‡Œã€‚
#
#  ç»™å®šçƒçš„èµ·å§‹ä½ç½®ï¼Œç›®çš„åœ°å’Œè¿·å®«ï¼Œæ‰¾å‡ºè®©çƒä»¥æœ€çŸ­è·ç¦»æ‰è¿›æ´é‡Œçš„è·¯å¾„ã€‚ è·ç¦»çš„å®šä¹‰æ˜¯çƒä»èµ·å§‹ä½ç½®ï¼ˆä¸åŒ…æ‹¬ï¼‰åˆ°ç›®çš„åœ°ï¼ˆåŒ…æ‹¬ï¼‰ç»è¿‡çš„ç©ºåœ°ä¸ªæ•°ã€‚é€šè¿‡'u', 'd'
# , 'l' å’Œ 'r'è¾“å‡ºçƒçš„ç§»åŠ¨æ–¹å‘ã€‚ ç”±äºå¯èƒ½æœ‰å¤šæ¡æœ€çŸ­è·¯å¾„ï¼Œ è¯·è¾“å‡ºå­—å…¸åºæœ€å°çš„è·¯å¾„ã€‚å¦‚æœçƒæ— æ³•è¿›å…¥æ´ï¼Œè¾“å‡º"impossible"ã€‚
#
#  è¿·å®«ç”±ä¸€ä¸ª0å’Œ1çš„äºŒç»´æ•°ç»„è¡¨ç¤ºã€‚ 1è¡¨ç¤ºå¢™å£ï¼Œ0è¡¨ç¤ºç©ºåœ°ã€‚ä½ å¯ä»¥å‡å®šè¿·å®«çš„è¾¹ç¼˜éƒ½æ˜¯å¢™å£ã€‚èµ·å§‹ä½ç½®å’Œç›®çš„åœ°çš„åæ ‡é€šè¿‡è¡Œå·å’Œåˆ—å·ç»™å‡ºã€‚
#
#
#
#  ç¤ºä¾‹1:
#
#  è¾“å…¥ 1: è¿·å®«ç”±ä»¥ä¸‹äºŒç»´æ•°ç»„è¡¨ç¤º
#
# 0 0 0 0 0
# 1 1 0 0 1
# 0 0 0 0 0
# 0 1 0 0 1
# 0 1 0 0 0
#
# è¾“å…¥ 2: çƒçš„åˆå§‹ä½ç½® (rowBall, colBall) = (4, 3)
# è¾“å…¥ 3: æ´çš„ä½ç½® (rowHole, colHole) = (0, 1)
#
# è¾“å‡º: "lul"
#
# è§£æ: æœ‰ä¸¤æ¡è®©çƒè¿›æ´çš„æœ€çŸ­è·¯å¾„ã€‚
# ç¬¬ä¸€æ¡è·¯å¾„æ˜¯ å·¦ -> ä¸Š -> å·¦, è®°ä¸º "lul".
# ç¬¬äºŒæ¡è·¯å¾„æ˜¯ ä¸Š -> å·¦, è®°ä¸º 'ul'.
# ä¸¤æ¡è·¯å¾„éƒ½å…·æœ‰æœ€çŸ­è·ç¦»6, ä½†'l' < 'u'ï¼Œæ•…ç¬¬ä¸€æ¡è·¯å¾„å­—å…¸åºæ›´å°ã€‚å› æ­¤è¾“å‡º"lul"ã€‚
#
#
#
#  ç¤ºä¾‹ 2:
#
#  è¾“å…¥ 1: è¿·å®«ç”±ä»¥ä¸‹äºŒç»´æ•°ç»„è¡¨ç¤º
#
# 0 0 0 0 0
# 1 1 0 0 1
# 0 0 0 0 0
# 0 1 0 0 1
# 0 1 0 0 0
#
# è¾“å…¥ 2: çƒçš„åˆå§‹ä½ç½® (rowBall, colBall) = (4, 3)
# è¾“å…¥ 3: æ´çš„ä½ç½® (rowHole, colHole) = (3, 0)
#
# è¾“å‡º: "impossible"
#
# ç¤ºä¾‹: çƒæ— æ³•åˆ°è¾¾æ´ã€‚
#
#
#
#
#
#  æ³¨æ„:
#
#
#  è¿·å®«ä¸­åªæœ‰ä¸€ä¸ªçƒå’Œä¸€ä¸ªç›®çš„åœ°ã€‚
#  çƒå’Œæ´éƒ½åœ¨ç©ºåœ°ä¸Šï¼Œä¸”åˆå§‹æ—¶å®ƒä»¬ä¸åœ¨åŒä¸€ä½ç½®ã€‚
#  ç»™å®šçš„è¿·å®«ä¸åŒ…æ‹¬è¾¹ç•Œ (å¦‚å›¾ä¸­çš„çº¢è‰²çŸ©å½¢), ä½†ä½ å¯ä»¥å‡è®¾è¿·å®«çš„è¾¹ç¼˜éƒ½æ˜¯å¢™å£ã€‚
#  è¿·å®«è‡³å°‘åŒ…æ‹¬2å—ç©ºåœ°ï¼Œè¡Œæ•°å’Œåˆ—æ•°å‡ä¸è¶…è¿‡30ã€‚
#
#  Related Topics æ·±åº¦ä¼˜å…ˆæœç´¢ å¹¿åº¦ä¼˜å…ˆæœç´¢ å›¾ æœ€çŸ­è·¯ å †ï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰
#  ğŸ‘ 46 ğŸ‘ 0


class Solution:
    def findShortestWay(self, maze: List[List[int]], ball: List[int], hole: List[int]) -> str:
        dirs = [(-1, 0), (0, 1), (1, 0), (0, -1)]
        dirs2 = ['u', 'r', 'd', 'l']
        res = []
        visted = set()
        R, C = len(maze), len(maze[0])
        sr, sc = ball
        q = [(0, '', sr, sc)]
        while q:
            dis, path, r, c = heapq.heappop(q)
            visted.add((r,c))
            if res and dis > res[0][0]:
                break
            for di in range(4):
                dr, dc = dirs[di]
                npath = path + dirs2[di]
                step = 1
                nr, nc = r + dr, c + dc
                if nr < 0 or nc < 0 or nr >= R or nc >= C or maze[nr][nc] == 1:
                    continue
                while 0 <= nr < R and 0 <= nc < C and maze[nr][nc] == 0:
                    if [nr, nc] == hole:
                        res.append((dis + step, npath))
                        break
                    step += 1
                    nr += dr
                    nc += dc
                if [nr, nc] != hole:
                    nr -= dr
                    nc -= dc
                    step -= 1
                    if (nr, nc) not in visted:
                        heapq.heappush(q, (dis + step, npath, nr, nc))
        return sorted(res)[0][1] if res else 'impossible'


Solution().findShortestWay(
    [[0, 1, 0, 0, 1, 0, 0, 1, 0, 0], [0, 0, 1, 0, 0, 1, 0, 0, 1, 0], [0, 0, 0, 0, 0, 0, 1, 0, 0, 1], [0, 0, 0, 0, 0, 0, 1, 0, 0, 1],
     [0, 1, 0, 0, 1, 0, 0, 1, 0, 0], [0, 0, 1, 0, 0, 1, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 1, 0, 0, 0], [1, 0, 0, 1, 0, 0, 0, 0, 0, 1],
     [0, 1, 0, 0, 1, 0, 0, 1, 0, 0], [0, 0, 0, 0, 0, 1, 0, 0, 1, 0]], [2, 4], [7, 6])
