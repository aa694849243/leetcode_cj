# -*- coding: utf-8 -*-
# ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² s ï¼ˆä¸‹æ ‡ä» 0 å¼€å§‹ï¼‰ã€‚ä½ éœ€è¦å¯¹ s æ‰§è¡Œä»¥ä¸‹æ“ä½œç›´åˆ°å®ƒå˜ä¸ºä¸€ä¸ªæœ‰åºå­—ç¬¦ä¸²ï¼š
#
#
#  æ‰¾åˆ° æœ€å¤§ä¸‹æ ‡ i ï¼Œä½¿å¾— 1 <= i < s.length ä¸” s[i] < s[i - 1] ã€‚
#  æ‰¾åˆ° æœ€å¤§ä¸‹æ ‡ j ï¼Œä½¿å¾— i <= j < s.length ä¸”å¯¹äºæ‰€æœ‰åœ¨é—­åŒºé—´ [i, j] ä¹‹é—´çš„ k éƒ½æœ‰ s[k] < s[i - 1] ã€‚
#  äº¤æ¢ä¸‹æ ‡ä¸º i - 1 å’Œ j å¤„çš„ä¸¤ä¸ªå­—ç¬¦ã€‚
#  å°†ä¸‹æ ‡ i å¼€å§‹çš„å­—ç¬¦ä¸²åç¼€åè½¬ã€‚
#
#
#  è¯·ä½ è¿”å›å°†å­—ç¬¦ä¸²å˜æˆæœ‰åºçš„æœ€å°‘æ“ä½œæ¬¡æ•°ã€‚ç”±äºç­”æ¡ˆå¯èƒ½ä¼šå¾ˆå¤§ï¼Œè¯·è¿”å›å®ƒå¯¹ 10â¹ + 7 å–ä½™ çš„ç»“æœã€‚
#
#
#
#  ç¤ºä¾‹ 1ï¼š
#
#  è¾“å…¥ï¼šs = "cba"
# è¾“å‡ºï¼š5
# è§£é‡Šï¼šæ¨¡æ‹Ÿè¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š
# æ“ä½œ 1ï¼ši=2ï¼Œj=2ã€‚äº¤æ¢ s[1] å’Œ s[2] å¾—åˆ° s="cab" ï¼Œç„¶ååè½¬ä¸‹æ ‡ä» 2 å¼€å§‹çš„åç¼€å­—ç¬¦ä¸²ï¼Œå¾—åˆ° s="cab" ã€‚
# æ“ä½œ 2ï¼ši=1ï¼Œj=2ã€‚äº¤æ¢ s[0] å’Œ s[2] å¾—åˆ° s="bac" ï¼Œç„¶ååè½¬ä¸‹æ ‡ä» 1 å¼€å§‹çš„åç¼€å­—ç¬¦ä¸²ï¼Œå¾—åˆ° s="bca" ã€‚
# æ“ä½œ 3ï¼ši=2ï¼Œj=2ã€‚äº¤æ¢ s[1] å’Œ s[2] å¾—åˆ° s="bac" ï¼Œç„¶ååè½¬ä¸‹æ ‡ä» 2 å¼€å§‹çš„åç¼€å­—ç¬¦ä¸²ï¼Œå¾—åˆ° s="bac" ã€‚
# æ“ä½œ 4ï¼ši=1ï¼Œj=1ã€‚äº¤æ¢ s[0] å’Œ s[1] å¾—åˆ° s="abc" ï¼Œç„¶ååè½¬ä¸‹æ ‡ä» 1 å¼€å§‹çš„åç¼€å­—ç¬¦ä¸²ï¼Œå¾—åˆ° s="acb" ã€‚
# æ“ä½œ 5ï¼ši=2ï¼Œj=2ã€‚äº¤æ¢ s[1] å’Œ s[2] å¾—åˆ° s="abc" ï¼Œç„¶ååè½¬ä¸‹æ ‡ä» 2 å¼€å§‹çš„åç¼€å­—ç¬¦ä¸²ï¼Œå¾—åˆ° s="abc" ã€‚
#
#
#  ç¤ºä¾‹ 2ï¼š
#
#  è¾“å…¥ï¼šs = "aabaa"
# è¾“å‡ºï¼š2
# è§£é‡Šï¼šæ¨¡æ‹Ÿè¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š
# æ“ä½œ 1ï¼ši=3ï¼Œj=4ã€‚äº¤æ¢ s[2] å’Œ s[4] å¾—åˆ° s="aaaab" ï¼Œç„¶ååè½¬ä¸‹æ ‡ä» 3 å¼€å§‹çš„åç¼€å­—ç¬¦ä¸²ï¼Œå¾—åˆ° s="aaaba" ã€‚
# æ“ä½œ 2ï¼ši=4ï¼Œj=4ã€‚äº¤æ¢ s[3] å’Œ s[4] å¾—åˆ° s="aaaab" ï¼Œç„¶ååè½¬ä¸‹æ ‡ä» 4 å¼€å§‹çš„åç¼€å­—ç¬¦ä¸²ï¼Œå¾—åˆ° s="aaaab" ã€‚
#
#
#  ç¤ºä¾‹ 3ï¼š
#
#  è¾“å…¥ï¼šs = "cdbea"
# è¾“å‡ºï¼š63
#
#  ç¤ºä¾‹ 4ï¼š
#
#  è¾“å…¥ï¼šs = "leetcodeleetcodeleetcode"
# è¾“å‡ºï¼š982157772
#
#
#
#
#  æç¤ºï¼š
#
#
#  1 <= s.length <= 3000
#  s åªåŒ…å«å°å†™è‹±æ–‡å­—æ¯ã€‚
#
#
#  Related Topics æ•°å­¦ å­—ç¬¦ä¸² ç»„åˆæ•°å­¦ ğŸ‘ 23 ğŸ‘ 0
import collections

# æ’åˆ—æ•°é—®é¢˜
# leetcode submit region begin(Prohibit modification and deletion)
class Solution:
    def makeStringSorted(self, s: str) -> int:
        mod = 10 ** 9 + 7
        n = len(s)
        fac = [1, 1]
        for i in range(2, n + 1):
            fac.append(fac[-1] * i % mod)
        facinv = [pow(f, mod - 2, mod) for f in fac]
        c = collections.Counter(s)
        ans = 0
        for i in range(n):
            # lst = sorted(s[i:])
            # rank = bisect.bisect_left(lst, s[i])
            rank = sum(v for k, v in c.items() if k < s[i])
            tmp = rank * fac[n - i - 1] % mod
            for k, v in c.items():
                tmp = tmp * facinv[v] % mod
            ans += tmp
            c[s[i]] -= 1
            if c[s[i]] == 0:
                c.pop(s[i])
        return ans % mod
# leetcode submit region end(Prohibit modification and deletion)
# authorï¼š caoji
# datetimeï¼š 2022-09-04 20:37 
# ideï¼š PyCharm
